<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ゲーム開始</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>ゲームスタート！</h1>

  <!-- フェード用オーバーレイ -->
  <div id="fadeOverlay" style="
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background-color: black;
    opacity: 1;
    transition: opacity 1.5s;
    z-index: 9999;
    pointer-events: none;
  "></div>

<script type="module">
  import {
    initializeApp, getApps, getApp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getDatabase, ref, get
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Firebase設定
  const firebaseConfig = {
    apiKey: "AIzaSyB1hyrktLnx7lzW2jf4ZeIzTrBEY-IEgPo",
    authDomain: "horror-game-9b2d2.firebaseapp.com",
    databaseURL: "https://horror-game-9b2d2-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "horror-game-9b2d2",
    storageBucket: "horror-game-9b2d2.appspot.com",
    messagingSenderId: "534762448588",
    appId: "1:534762448588:web:e0a6a01cd14c7f1dce4469"
  };

  const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
  const db = getDatabase(app);

  const fadeOverlay = document.getElementById("fadeOverlay");
  const list = document.getElementById("turnOrderList");

  // ✅ localStorage からルーム番号を取得（事前に保存しておいてね）
  const roomCode = localStorage.getItem("roomCode");

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  async function loadAndShowPlayers() {
    const playersSnap = await get(ref(db, `rooms/${roomCode}/players`));
    const players = playersSnap.val() || {};
    const playerNames = Object.values(players).map(p => p.name || "名無し");
    const shuffled = shuffleArray(playerNames);

    shuffled.forEach((name, index) => {
      const li = document.createElement("li");
      li.textContent = `${index + 1}. ${name}`;
      list.appendChild(li);
    });
  }

  // ✅ フェードアウト演出 → 終わったらプレイヤー表示
  window.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
      fadeOverlay.style.opacity = "0";
    }, 100);

    fadeOverlay.addEventListener("transitionend", () => {
      fadeOverlay.style.display = "none";
      loadAndShowPlayers();
    });
  });
</script>


</body>
</html>
